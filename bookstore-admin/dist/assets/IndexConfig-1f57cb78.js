import{r as T,d as w,o as S,c as U,w as a,b as y,f as t,h as x,D as f,i as g,j as R,k as z,g as M,m as E,K as $,_ as q,t as A,u as O,y as j,e as K,L,E as Q,M as V,C as G,N as H,O as J,P as W,Q as X,R as Y,S as Z,p as ee,a as oe}from"./index-9e848275.js";/* empty css             *//* empty css               *//* empty css              *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                   *//* empty css                *//* empty css                  */const te={class:"dialog-footer"},ne={__name:"DialogAddBook",props:{type:String,configType:Number,reload:Function},setup(u,{expose:k}){const s=u,h=T(null),e=w({visible:!1,ruleForm:{name:"",link:"",id:1,sort:1},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],id:[{required:"true",message:"编号不能为空",trigger:["change"]}],sort:[{required:"true",message:"排序不能为空",trigger:["change"]}]},id:""}),_=i=>{g.get(`/indexConfigs/${i}`).then(n=>{e.ruleForm={name:n.configName,id:n.booksId,link:n.redirectUrl,sort:n.configRank}})},o=i=>{e.visible=!0,i?(e.id=i,_(i)):e.ruleForm={name:"",id:1,link:"",sort:1}},d=()=>{e.visible=!1},C=()=>{h.value.validate(i=>{if(i){if(e.ruleForm.id<1){f.error("图书编号不能小于 1");return}if(s.type==="add")g.post("/indexConfigs",{configType:s.configType||3,configName:e.ruleForm.name,redirectUrl:e.ruleForm.link,booksId:e.ruleForm.id,configRank:e.ruleForm.sort}).then(()=>{f.success("添加成功"),e.visible=!1,s.reload&&s.reload()});else{let n={configId:e.id,configType:s.configType||3,configName:e.ruleForm.name,redirectUrl:e.ruleForm.link,booksId:e.ruleForm.id,configRank:e.ruleForm.sort};g.put("/indexConfigs",n).then(()=>{f.success("修改成功"),e.visible=!1,s.reload&&s.reload()})}}})};return k({open:o,close:d}),(i,n)=>{const p=R,m=z,F=M,l=E,v=$;return S(),U(v,{title:u.type==="add"?"添加图书":"修改图书",modelValue:e.visible,"onUpdate:modelValue":n[5]||(n[5]=r=>e.visible=r),width:"400px"},{footer:a(()=>[y("span",te,[t(l,{onClick:n[4]||(n[4]=r=>e.visible=!1)},{default:a(()=>[x("取 消")]),_:1}),t(l,{type:"primary",onClick:C},{default:a(()=>[x("确 定")]),_:1})])]),default:a(()=>[t(F,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:h,"label-width":"100px",class:"book-form"},{default:a(()=>[t(m,{label:"图书名称",prop:"name"},{default:a(()=>[t(p,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":n[0]||(n[0]=r=>e.ruleForm.name=r)},null,8,["modelValue"])]),_:1}),t(m,{label:"跳转链接",prop:"link"},{default:a(()=>[t(p,{type:"text",modelValue:e.ruleForm.link,"onUpdate:modelValue":n[1]||(n[1]=r=>e.ruleForm.link=r)},null,8,["modelValue"])]),_:1}),t(m,{label:"图书编号",prop:"id"},{default:a(()=>[t(p,{type:"number",min:"1",modelValue:e.ruleForm.id,"onUpdate:modelValue":n[2]||(n[2]=r=>e.ruleForm.id=r),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),t(m,{label:"排序值",prop:"sort"},{default:a(()=>[t(p,{type:"number",min:"1",modelValue:e.ruleForm.sort,"onUpdate:modelValue":n[3]||(n[3]=r=>e.ruleForm.sort=r),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}};const le=u=>(ee("data-v-49deffbe"),u=u(),oe(),u),ae={class:"header"},re=["href"],ie=["onClick"],se=le(()=>y("a",{style:{cursor:"pointer"}},"删除",-1)),de={__name:"IndexConfig",setup(u){const k={hot:3,new:4,recommend:5},s=A(),h=O(),e=T(null),_=T(null),o=w({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",configType:3});s.beforeEach(l=>{["hot","new","recommend"].includes(l.name)&&(o.configType=k[l.name],o.currentPage=1,d())}),j(()=>{o.configType=k[h.name],d()});const d=()=>{o.loading=!0,g.get("/indexConfigs",{params:{pageNumber:o.currentPage,pageSize:o.pageSize,configType:o.configType}}).then(l=>{o.tableData=l.list,o.total=l.totalCount,o.currentPage=l.currPage,o.loading=!1})},C=()=>{o.type="add",_.value.open()},i=l=>{o.type="edit",_.value.open(l)},n=l=>{o.multipleSelection=l},p=()=>{if(!o.multipleSelection.length){f.error("请选择项");return}g.post("/indexConfigs/delete",{ids:o.multipleSelection.map(l=>l.configId)}).then(()=>{f.success("删除成功"),d()})},m=l=>{g.post("/indexConfigs/delete",{ids:[l]}).then(()=>{f.success("删除成功"),d()})},F=l=>{o.currentPage=l,d()};return(l,v)=>{const r=E,I=H,c=J,B=W,P=X,D=Q;return S(),K(L,null,[t(D,{class:"index-container"},{header:a(()=>[y("div",ae,[t(r,{type:"primary",icon:V(Y),onClick:C},{default:a(()=>[x("增加")]),_:1},8,["icon"]),t(I,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:p},{reference:a(()=>[t(r,{type:"danger",icon:V(Z)},{default:a(()=>[x("批量删除")]),_:1},8,["icon"])]),_:1})])]),default:a(()=>[t(B,{load:o.loading,ref_key:"multipleTable",ref:e,data:o.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:n},{default:a(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"configName",label:"图书名称"}),t(c,{label:"跳转链接"},{default:a(b=>[y("a",{target:"_blank",href:b.row.redirectUrl},G(b.row.redirectUrl),9,re)]),_:1}),t(c,{prop:"configRank",label:"排序值",width:"120"}),t(c,{prop:"booksId",label:"图书编号",width:"200"}),t(c,{prop:"createTime",label:"添加时间",width:"200"}),t(c,{label:"操作",width:"100"},{default:a(b=>[y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:N=>i(b.row.configId)},"修改",8,ie),t(I,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:N=>m(b.row.configId)},{reference:a(()=>[se]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),t(P,{background:"",layout:"prev, pager, next",total:o.total,"page-size":o.pageSize,"current-page":o.currentPage,onCurrentChange:F},null,8,["total","page-size","current-page"])]),_:1}),t(ne,{ref_key:"addBook",ref:_,reload:d,type:o.type,configType:o.configType},null,8,["type","configType"])],64)}}},he=q(de,[["__scopeId","data-v-49deffbe"]]);export{he as default};
