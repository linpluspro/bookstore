import{r as S,u as B,d as V,o as L,c as N,w as r,b as y,f as l,h as b,i as g,D as m,j as $,k as z,g as q,m as P,K as U,t as M,y as A,T as O,U as j,E as K,M as w,N as Q,O as G,P as H,Q as J,R as W,S as X}from"./index-9e848275.js";/* empty css             *//* empty css               *//* empty css              *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                   *//* empty css                *//* empty css                  */const Y={class:"dialog-footer"},Z={__name:"DialogAddCategory",props:{type:String,reload:Function},setup(F,{expose:_}){const i=F,v=S(null),t=B(),e=V({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:1},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""}),d=n=>{g.get(`/categories/${n}`).then(o=>{e.ruleForm={name:o.mallBooksCategory.categoryName,rank:o.mallBooksCategory.categoryRank},e.parentId=o.mallBooksCategory.parentId,e.categoryLevel=o.mallBooksCategory.categoryLevel})},k=n=>{if(e.visible=!0,n)e.id=n,d(n);else{const{level:o=1,parent_id:p=0}=t.query;e.ruleForm={name:"",rank:1},e.parentId=p,e.categoryLevel=o}},C=()=>{e.visible=!1},I=()=>{v.value.validate(n=>{if(n)if(i.type==="add"){let o={categoryLevel:parseInt(e.categoryLevel),parentId:parseInt(e.parentId),categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank};g.post("/categories",o).then(()=>{m.success("添加成功"),e.visible=!1,i.reload&&i.reload()})}else g.put("/categories",{categoryId:e.id,categoryLevel:parseInt(e.categoryLevel),parentId:parseInt(e.categoryLevel),categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank}).then(()=>{m.success("修改成功"),e.visible=!1,i.reload&&i.reload()})})};return _({open:k,close:C}),(n,o)=>{const p=$,h=z,a=q,s=P,u=U;return L(),N(u,{title:e.type==="add"?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":o[3]||(o[3]=c=>e.visible=c),width:"400px"},{footer:r(()=>[y("span",Y,[l(s,{onClick:o[2]||(o[2]=c=>e.visible=!1)},{default:r(()=>[b("取 消")]),_:1}),l(s,{type:"primary",onClick:I},{default:r(()=>[b("确 定")]),_:1})])]),default:r(()=>[l(a,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:v,"label-width":"100px",class:"book-form"},{default:r(()=>[l(h,{label:"图书名称",prop:"name"},{default:r(()=>[l(p,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":o[0]||(o[0]=c=>e.ruleForm.name=c)},null,8,["modelValue"])]),_:1}),l(h,{label:"排序值",prop:"rank"},{default:r(()=>[l(p,{type:"number",min:"1",modelValue:e.ruleForm.rank,"onUpdate:modelValue":o[1]||(o[1]=c=>e.ruleForm.rank=c),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},ee={class:"header"},te=["onClick"],ae=["onClick"],oe=y("a",{style:{cursor:"pointer"}},"删除",-1),ge={__name:"Category",setup(F){const _=S(null),i=M(),v=B(),t=V({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});A(()=>{d()}),O(()=>{console.log(t.pageSize)});const e=i.afterEach(a=>{["category","level2","level3"].includes(a.name)&&d()});j(()=>{e()});const d=()=>{const{level:a=1,parent_id:s=0}=v.query;t.loading=!0,g.get("/categories",{params:{pageNumber:t.currentPage,pageSize:t.pageSize,categoryLevel:a,parentId:s}}).then(u=>{t.tableData=u.list,t.total=u.totalCount,t.currentPage=u.currPage,t.loading=!1,t.level=a,t.parentId=s})},k=a=>{t.currentPage=a,d()},C=a=>{const s=a.categoryLevel+1;if(s===4){m.error("没有下一级");return}i.push({name:`level${s}`,query:{level:s,parent_id:a.categoryId}})},I=()=>{t.type="add",_.value.open()},n=a=>{t.type="edit",_.value.open(a)},o=a=>{t.multipleSelection=a},p=()=>{if(!t.multipleSelection.length){m.error("请选择项");return}g.delete("/categories",{data:{ids:t.multipleSelection.map(a=>a.categoryId)}}).then(()=>{m.success("删除成功"),d()})},h=a=>{g.delete("/categories",{data:{ids:[a]}}).then(()=>{m.success("删除成功"),d()})};return(a,s)=>{const u=P,c=Q,f=G,T=H,D=J,R=K;return L(),N(R,{class:"category-container"},{header:r(()=>[y("div",ee,[l(u,{type:"primary",icon:w(W),onClick:I},{default:r(()=>[b("增加")]),_:1},8,["icon"]),l(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:p},{reference:r(()=>[l(u,{type:"danger",icon:w(X)},{default:r(()=>[b("批量删除")]),_:1},8,["icon"])]),_:1})])]),default:r(()=>[l(T,{load:t.loading,ref:"multipleTable",data:t.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:o},{default:r(()=>[l(f,{type:"selection",width:"55"}),l(f,{prop:"categoryName",label:"分类名称"}),l(f,{prop:"categoryRank",label:"排序值",width:"120"}),l(f,{prop:"createTime",label:"添加时间",width:"200"}),l(f,{label:"操作",width:"220"},{default:r(x=>[y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:E=>n(x.row.categoryId)},"修改",8,te),y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:E=>C(x.row)},"下级分类",8,ae),l(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:E=>h(x.row.categoryId)},{reference:r(()=>[oe]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),l(D,{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,onCurrentChange:k},null,8,["total","page-size","current-page"]),l(Z,{ref_key:"addCate",ref:_,reload:d,type:t.type},null,8,["type"])]),_:1})}}};export{ge as default};
